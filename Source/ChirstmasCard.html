<!DOCTYPE html>

<head>
    <title>Cristmas Card!</title>

</head>

<body id="MainBody">

    <div id="container">
        <canvas id="MainCanvas" width="1000" height="1000"></canvas>
    </div>

    <script src="Vector2D.js"></script>
    <script src="CanvasRenderingContextExtensions.js"></script>
    <script src="DrawObj.js"></script>
    <script src="PhysicsObject.js"></script>
    <script src="Snowflake.js"></script>
    <script src="SnowCollection.js"></script>


    <script src="configurations.js"></script>

    <link rel="stylesheet" href="ChristmasCard.css">
</body>

<script>
    const frameRate = settings.RefeashRate;
    let deltaTime = 0;

    var body = document.getElementById("MainBody");
    var canvas = document.getElementById("MainCanvas");

    var container = document.getElementById("container");

    window.addEventListener('resize', () => {
        updateContainer();
    });

    let ctx = canvas.getContext("2d");

    let backgroundImage = new Image();
    backgroundImage.src = assets.backgroundSrc;

    let sceneObjs = [];

    let snowflakeSrc = assets.snowflakeSrc;
    let snowCollection = new SnowCollection(snowflakeSrc, 1, 10, 35);
    sceneObjs = (snowCollection.snowflakes);

    let audio = new Audio(assets.audioSrc);
    audio.play();

    updateContainer();
    gameLoop();

    function gameLoop() {
        ctx.clearCanvas();
        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

        deltaTime = frameRate / 1000;

        updateContainer();

        // hack to place text at center
        let message = 'Happy new year!';
        ctx.drawText(message,
            canvas.width / 2 - 13 * message.length, canvas.height / 4,
            "#FF0000",
            true,
            '60px Cursive');

        sceneObjs.forEach(element => element.update(deltaTime))
        sceneObjs.forEach(element => element.render(ctx))

        setInterval(gameLoop, frameRate);
    }


    function updateContainer() {

        let width = window.innerWidth;
        let height = window.innerHeight;

        var aspectRatio = settings.aspectRatio;
        var currentWidthToHeight = width / height;


        if (currentWidthToHeight >= aspectRatio) {
            // window width is too wide relative to desired game width
            width = height * aspectRatio;
            container.style.height = height + 'px';
            container.style.width = width + 'px';
        } else { // window height is too high relative to desired game height
            height = width / aspectRatio;
            container.style.width = width + 'px';
            container.style.height = height + 'px';
        }

        container.style.marginTop = (-height / 2) + 'px';
        container.style.marginLeft = (-width / 2) + 'px';
    }

    container.addEventListener('mousedown', function (clickedElement) {
        let cursorPos = getCursorPosition(clickedElement);
        snowCollection.repulse(cursorPos, 500, 0.1);
    })

    function getCursorPosition(clickedElement) {
        const rect = container.getBoundingClientRect()

        x = canvas.width * (clickedElement.clientX - rect.left) / (rect.right - rect.left);
        y = canvas.height * (clickedElement.clientY - rect.top) / (rect.bottom - rect.top);

        return new Vector2D(x, y);
    }


    /*
    SOURCES & CREDITS
        // The code for applying the aspect ratio was taken from the case study: Case Study: Auto-Resizing HTML5 Games:
        // https://www.html5rocks.com/en/tutorials/casestudies/gopherwoord-studios-resizing-html5-games/

        // the get cursor position was taken by: 
        https://stackoverflow.com/questions/55677/how-do-i-get-the-coordinates-of-a-mouse-click-on-a-canvas-element/18053642#18053642
    
    */
</script>

</html>